<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QuantCam</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#0e1116" />
  <style>
    html,body{margin:0;height:100%;background:#0e1116;color:#e6edf3;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
    .wrap{min-height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;padding:24px;text-align:center}
    h1{font-size:22px;margin:0}
    button{font-size:18px;padding:14px 18px;border-radius:14px;border:0;cursor:pointer;background:#2d6cdf;color:#fff}
    button:disabled{opacity:.6;cursor:not-allowed}
    .note{opacity:.8;font-size:14px}
    #status{white-space:pre-wrap;font-family:ui-monospace,Consolas,monospace;font-size:13px;background:#12161c;border:1px solid #1f232a;border-radius:12px;padding:12px;max-width:680px}
  </style>
</head>
<body>
<div class="wrap">
  <img src="icons/icon-192.png" alt="" width="72" height="72" style="border-radius:16px;box-shadow:0 6px 24px rgba(0,0,0,.35)">
  <h1>QuantCam â€” Point â€¢ Shoot â€¢ Quant</h1>
  <button id="btn">ðŸ“· Open Camera & Quantify</button>
  <div class="note">Takes a photo, uploads to QuantCam backend, logs + routes in Drive, returns a summary.</div>
  <div id="status">Idle.</div>
</div>

<script>
const BACKEND = "<YOUR_BACKEND_URL>"; // <-- paste your Apps Script /exec URL here

const btn = document.getElementById('btn');
const statusEl = document.getElementById('status');

function log(msg){ statusEl.textContent = String(msg); }

async function upload(file){
  log("Uploadingâ€¦");
  const fd = new FormData();
  fd.append("file", file);
  // Optional: include hints/metadata if your script expects them
  // fd.append("source", "QuantCamPWA");

  const res = await fetch(BACKEND, { method: "POST", body: fd });
  if (!res.ok){ throw new Error("Backend HTTP " + res.status); }

  // Backend should return JSON; fall back to text if not
  const ct = res.headers.get("content-type")||"";
  const out = ct.includes("application/json") ? await res.json() : await res.text();
  log("Done.\n" + (typeof out === "string" ? out : JSON.stringify(out, null, 2)));
}

function openCamera(){
  const input = document.createElement("input");
  input.type = "file";
  input.accept = "image/*";
  input.capture = "environment"; // mobile: back camera
  input.onchange = () => {
    const file = input.files && input.files[0];
    if (!file){ return; }
    btn.disabled = true;
    upload(file).catch(e => log("Error: " + e.message)).finally(()=> btn.disabled = false);
  };
  input.click();
}

btn.addEventListener("click", openCamera);

// Register the service worker if present
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("./service-worker.js").catch(()=>{});
  });
}
</script>
</body>
</html>
