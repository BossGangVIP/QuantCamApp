<!doctype html>
<html lang="en">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>QuantCam</title>
<style>
  body{margin:0;background:#0f172a;color:#e2e8f0;font-family:system-ui,Segoe UI,Roboto,Arial}
  header{padding:14px 16px;font-weight:700}
  main{display:grid;gap:12px;padding:16px}
  video,canvas{width:100%;max-width:520px;border-radius:12px;background:#111827}
  button{padding:12px 16px;border:0;border-radius:10px;font-weight:700}
  .primary{background:#22c55e;color:#04110a}
  .muted{background:#334155;color:#e2e8f0}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .note{opacity:.75;font-size:.9rem}
</style>
<header>ðŸ“· QuantCam</header>
<main>
  <div class="note">Tap <b>Open Camera</b> then <b>Capture & Upload</b>. If the preview is black, give the site camera permission.</div>
  <div class="row">
    <button id="open" class="primary">Open Camera</button>
    <button id="snap" class="muted" disabled>Capture & Upload</button>
  </div>
  <video id="v" playsinline autoplay muted></video>
  <canvas id="c" hidden></canvas>
  <div id="status" class="note"></div>
</main>

<script>
  // â¬‡ï¸ paste your Apps Script /exec URL between the quotes:
  const UPLOADER_URL = "";   // e.g. "https://script.google.com/macros/s/.../exec"

  const v = document.getElementById('v');
  const c = document.getElementById('c');
  const openBtn = document.getElementById('open');
  const snapBtn = document.getElementById('snap');
  const statusEl = document.getElementById('status');
  let stream;

  function say(t){ statusEl.textContent = t; }

  openBtn.onclick = async () => {
    try {
      stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
      v.srcObject = stream;
      snapBtn.disabled = false;
      say('Camera ready.');
    } catch (e) {
      say('Camera blocked. Allow permissions, then reload.');
    }
  };

  snapBtn.onclick = async () => {
    try {
      const vw = v.videoWidth || 1080, vh = v.videoHeight || 1920;
      c.width = vw; c.height = vh;
      c.getContext('2d').drawImage(v, 0, 0, vw, vh);
      const blob = await new Promise(r => c.toBlob(r, 'image/jpeg', 0.9));
      say('Uploadingâ€¦');
      if (!UPLOADER_URL) { say('Missing uploader URL. Edit index.html and set UPLOADER_URL.'); return; }

      const form = new FormData();
      form.append('file', blob, `quantcam_${Date.now()}.jpg`);
      form.append('source','quantcam');
      const res = await fetch(UPLOADER_URL, { method:'POST', body: form });
      const txt = await res.text();
      say(res.ok ? 'Uploaded âœ“' : `Upload error: ${txt}`);
    } catch (e) {
      say('Error: ' + (e && e.message ? e.message : e));
    }
  };
</script>
</html>
